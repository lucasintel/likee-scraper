crystal_doc_search_index_callback({"repository_name":"Likee Scraper","body":"# Likee Scraper\n\n[![Built with Crystal 1.1.0](https://img.shields.io/badge/Crystal-1.1.0-%23333333)](https://crystal-lang.org/)\n[![GitHub release](https://img.shields.io/github/release/kandayo/likee-scraper.svg?label=Release)](https://github.com/kandayo/likee-scraper/releases)\n[![Unit Tests](https://github.com/kandayo/likee-scraper/workflows/Unit%20Tests/badge.svg)](https://github.com/kandayo/likee-scraper/actions)\n[![Integration Tests](https://github.com/kandayo/likee-scraper/workflows/Integration%20Tests/badge.svg)](https://github.com/kandayo/likee-scraper/actions)\n\nDownload videos from Likee, in their original quality, without watermark.\n\nThe integration tests are scheduled to run twice a day, through Github Actions.\n\nSee also: [**Likee API Wrapper**](https://github.com/kandayo/likee.cr).\n\n## Index\n\n- [Features](#features)\n- [Disclaimer](#disclaimer)\n- [Installation](#installation)\n  - [Pre-built - Recommended](#pre-built--recommended)\n  - [From source](#from-source)\n- [Usage](#usage)\n  - [Download profile by @username](#download-profile-by-username)\n  - [Download profile by User ID](#download-profile-by-user-id)\n  - [Batch file](#batch-file)\n  - [Fast update](#fast-update)\n- [Contributing](#contributing)\n- [Contributors](#contributors)\n\n## Features\n\n```\n$ likeer --user @Likee_US --user @Likee_UK --fast-update\n\nDownloading 2 profiles: @Likee_US @Likee_UK.\n\nCollecting videos from profile @Likee_US.\n + Likee US - 000005.mp4 [========================] 11.1 MB | 100%\n + Likee US - 000004.mp4; exists\nâœ… Likee US in sync!\n\nCollecting videos from profile @Likee_UK.\n + Likee UK - 000011.mp4 [========================] 22.2 MB | 100%\n + Likee UK - 000010.mp4; exists\nâœ… Likee UK in sync!\n\n$ ls\n.\nâ”œâ”€â”€ 11111111\nâ”‚   â”œâ”€â”€ 2021-01-01 00:14:01 - 000005.mp4\nâ”‚   â”œâ”€â”€ 2021-01-01 00:15:01 - 000004.mp4\nâ”‚   â””â”€â”€ [...]\nâ”œâ”€â”€ 22222222\nâ”‚   â”œâ”€â”€ 2021-01-02 00:14:01 - 000011.mp4\nâ”‚   â”œâ”€â”€ 2021-01-02 00:15:01 - 000010.mp4\nâ”‚   â””â”€â”€ [...]\nâ””â”€â”€\n```\n\n- Download profiles by @username or User ID.\n- **Built with archivists in mind: incremental sync.**\n- JSON metadata is stored alongside the video.\n- Batch file, cronjob friendly.\n\n## Disclaimer\n\nThis app is in no way affiliated with, authorized, maintained or endorsed by\nLikee or any of its affiliates or subsidiaries.\n\nThis is purely an educational proof of concept.\n\n## Installation\n\n### Pre-built - Recommended\n\nJust download the latest release for your platform [here](https://github.com/kandayo/likee-scraper/releases).\n\nThen move the binary to your PATH, or just use it right away.\n\n### From source\n\nIt only takes a few seconds to compile it yourself. It's not rocket science.\n\nBuild dependencies:\n - Crystal language, https://crystal-lang.org/install.\n\n```bash\n$ git clone https://github.com/kandayo/likee-scraper\n$ cd likee-scraper\n$ shards build --release --ignore-crystal-version\n$ ./bin/likeer --help\n```\n\nThen move the binary to your PATH, or just use it right away.\n\n## Usage\n\nFor more examples, please refer to the [**documentation**](https://absolab.xyz/likee-scraper).\n\n### Download profile by @username\n\nLooking up a user by username requires an additional API request. It's strongly\nrecommended to use User IDs instead. Usernames must be prefixed with an `@`.\n\n```bash\n$ likeer -u @username1 -u @username2 [...]\n```\n\n### Download profile by User ID\n\nIf a identifier does not have a prefix, it is assumed to be an User ID.\n\n```bash\n$ likeer -u 11111111\n```\n\n### Batch file\n\nIf `--batch-file <file.txt>` (or `-a`) is given, Likee will read *file.txt*\nexpecting @usernames and User IDs to download, one identifier per line.\nLines starting with an `#` or empty lines are considered as comments and\nignored.\n\nUsernames must be prefixed with an `@`, e.g. `@username`.\n\nIDs must not be prefixed with an `@`, e.g. `1111111`.\n\n```bash\n$ cat batch.txt\n~> # Comment (ignored)\n~> @username   # Inline comments are also allowed.\n~> 111111111\n\n$ likeer -a batch.txt\n```\n\n### Fast update\n\nIf `--fast-update` (or `-f`) is given, Likeer stops when arriving at the\nfirst already downloaded video. This flag is recommended when you use Likeer\nto update your personal archive.\n\nThis concept was inspired by Instaloader.\n\n```\n$ likeer -f -u @username\n\nDownloading 1 profile: @username.\n\nCollecting videos from profile @username.\n + Example Username - 000003.mp4 [========================] 11.1 MB | 100%\n + Example Username - 000002.mp4; exists\nâœ… Example Username in sync!\n```\n\n## Contributing\n\n1. Fork it (<https://github.com/kandayo/likee-scraper/fork>)\n2. Create your feature branch (`git checkout -b my-new-feature`)\n3. Commit your changes (`git commit -am 'Add some feature'`)\n4. Push to the branch (`git push origin my-new-feature`)\n5. Create a new Pull Request\n\n## Contributors\n\n- [kandayo](https://github.com/kandayo) - creator and maintainer\n","program":{"html_id":"Likee Scraper/toplevel","path":"toplevel.html","kind":"module","full_name":"Top Level Namespace","name":"Top Level Namespace","abstract":false,"superclass":null,"ancestors":[],"locations":[],"repository_name":"Likee Scraper","program":true,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":null,"doc":null,"summary":null,"class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"Likee Scraper/LikeeScraper","path":"LikeeScraper.html","kind":"module","full_name":"LikeeScraper","name":"LikeeScraper","abstract":false,"superclass":null,"ancestors":[],"locations":[],"repository_name":"Likee Scraper","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[{"id":"VERSION","name":"VERSION","value":"{{ (`shards version \\\"/home/runner/work/likee-scraper/likee-scraper/src/likee_scraper\\\"`).strip.stringify }}","doc":null,"summary":null}],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":null,"doc":null,"summary":null,"class_methods":[{"id":"download_user(username_or_id:String,fast_update=false):Nil-class-method","html_id":"download_user(username_or_id:String,fast_update=false):Nil-class-method","name":"download_user","doc":null,"summary":null,"abstract":false,"args":[{"name":"username_or_id","doc":null,"default_value":"","external_name":"username_or_id","restriction":"String"},{"name":"fast_update","doc":null,"default_value":"false","external_name":"fast_update","restriction":""}],"args_string":"(username_or_id : String, fast_update = <span class=\"n\">false</span>) : Nil","args_html":"(username_or_id : String, fast_update = <span class=\"n\">false</span>) : Nil","location":{"filename":"src/likee_scraper.cr","line_number":12,"url":null},"def":{"name":"download_user","args":[{"name":"username_or_id","doc":null,"default_value":"","external_name":"username_or_id","restriction":"String"},{"name":"fast_update","doc":null,"default_value":"false","external_name":"fast_update","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Nil","visibility":"Public","body":"user_id = (UsernameNormalizer.new(username_or_id)).call\nif user_id.nil?\n  Log.error do\n    \"ðŸš© User not found: #{username_or_id}\"\n  end\n  return\nend\nVideoCollector.collect_each(user_id: user_id) do |video|\n  downloaded = (VideoDownloader.new(video)).call\n  if fast_update && (!downloaded)\n    Log.info do\n      \"âœ… User #{username_or_id} in sync!\"\n    end\n    return\n  end\nend\n"}},{"id":"download_users(users=[]ofString,fast_update=false):Nil-class-method","html_id":"download_users(users=[]ofString,fast_update=false):Nil-class-method","name":"download_users","doc":null,"summary":null,"abstract":false,"args":[{"name":"users","doc":null,"default_value":"[] of String","external_name":"users","restriction":""},{"name":"fast_update","doc":null,"default_value":"false","external_name":"fast_update","restriction":""}],"args_string":"(users = <span class=\"o\">[]</span> <span class=\"k\">of</span> <span class=\"t\">String</span>, fast_update = <span class=\"n\">false</span>) : Nil","args_html":"(users = <span class=\"o\">[]</span> <span class=\"k\">of</span> <span class=\"t\">String</span>, fast_update = <span class=\"n\">false</span>) : Nil","location":{"filename":"src/likee_scraper.cr","line_number":30,"url":null},"def":{"name":"download_users","args":[{"name":"users","doc":null,"default_value":"[] of String","external_name":"users","restriction":""},{"name":"fast_update","doc":null,"default_value":"false","external_name":"fast_update","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Nil","visibility":"Public","body":"Log.info do\n  \"\\nDownloading #{users.size} profiles: #{users.join(' ')}.\"\nend\nusers.each do |username_or_id|\n  Log.info do\n    \"\\nCollecting videos from profile #{username_or_id}.\"\n  end\n  download_user(username_or_id, fast_update: fast_update)\nend\n"}},{"id":"run-class-method","html_id":"run-class-method","name":"run","doc":null,"summary":null,"abstract":false,"args":[],"args_string":"","args_html":"","location":{"filename":"src/likee_scraper.cr","line_number":39,"url":null},"def":{"name":"run","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"LikeeScraper::CLI.run"}}],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"Likee Scraper/LikeeScraper/CLI","path":"LikeeScraper/CLI.html","kind":"module","full_name":"LikeeScraper::CLI","name":"CLI","abstract":false,"superclass":null,"ancestors":[],"locations":[],"repository_name":"Likee Scraper","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"Likee Scraper/LikeeScraper","kind":"module","full_name":"LikeeScraper","name":"LikeeScraper"},"doc":null,"summary":null,"class_methods":[{"id":"run:Nil-class-method","html_id":"run:Nil-class-method","name":"run","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : Nil","args_html":" : Nil","location":{"filename":"src/likee_scraper/cli.cr","line_number":3,"url":null},"def":{"name":"run","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Nil","visibility":"Public","body":"usernames_or_user_ids = [] of String\nfast_update = false\nparsed = OptionParser.parse do |parser|\n  parser.banner = \"Usage: likeer [arguments]\"\n  parser.on(\"-u @USERNAMEâ €orâ €ID\", \"--user @USERNAMEâ €orâ €ID\", \"Download videos (and their metadata) published by the given user.\\nÂ» Username: @Likee_USA (starts with an \\\"@\\\")\\nÂ» ID: 3007\\n\") do |value|\n    usernames_or_user_ids << value.strip\n  end\n  parser.on(\"-a FILE\", \"--batch-file FILE\", \"File containing @usernames or User IDs to download, one identifier\\nper line. Empty lines or lines starting with '#' are considered as\\ncomments and ignored.\\n\") do |value|\n    extracted_ids = FileProcessor.call(value)\n    if extracted_ids\n      usernames_or_user_ids = usernames_or_user_ids + extracted_ids\n    else\n      STDERR.puts(\"No such file or directory: #{value}\")\n      exit(1)\n    end\n  end\n  parser.on(\"-f\", \"--fast-update\", \"Stop when encountering the first already-downloaded video.\\nThis flag is recommended when you use Likeer to update your\\npersonal archive.\\n\") do\n    fast_update = true\n  end\n  parser.on(\"-v\", \"--version\", \"Show the version number and exit.\") do\n    puts(VERSION)\n    exit(0)\n  end\n  parser.on(\"-h\", \"--help\", \"Show this help message and exit.\") do\n    puts(parser)\n    exit(0)\n  end\n  parser.missing_option do |flag|\n    STDERR.puts(\"ERROR: #{flag} flag expects a argument\\n\\n\")\n    STDERR.puts(parser)\n    exit(1)\n  end\n  parser.invalid_option do |flag|\n    STDERR.puts(\"ERROR: #{flag} is not a valid option.\\n\\n\")\n    STDERR.puts(parser)\n    exit(1)\n  end\nend\nif usernames_or_user_ids.empty?\n  STDERR.puts(\"ERROR: Missing target user(s).\\n\\n\")\n  STDERR.puts(parsed)\n  exit(1)\nend\nLikeeScraper.download_users(usernames_or_user_ids, fast_update: fast_update)\n"}}],"constructors":[],"instance_methods":[],"macros":[],"types":[{"html_id":"Likee Scraper/LikeeScraper/CLI/FileProcessor","path":"LikeeScraper/CLI/FileProcessor.html","kind":"class","full_name":"LikeeScraper::CLI::FileProcessor","name":"FileProcessor","abstract":false,"superclass":{"html_id":"Likee Scraper/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"Likee Scraper/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"Likee Scraper/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[],"repository_name":"Likee Scraper","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[{"id":"INLINE_COMMENTS_REGEX","name":"INLINE_COMMENTS_REGEX","value":"/\\#.*$/","doc":null,"summary":null}],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"Likee Scraper/LikeeScraper/CLI","kind":"module","full_name":"LikeeScraper::CLI","name":"CLI"},"doc":null,"summary":null,"class_methods":[{"id":"call(file:String):Array(String)?-class-method","html_id":"call(file:String):Array(String)?-class-method","name":"call","doc":null,"summary":null,"abstract":false,"args":[{"name":"file","doc":null,"default_value":"","external_name":"file","restriction":"String"}],"args_string":"(file : String) : Array(String)?","args_html":"(file : String) : Array(String)?","location":{"filename":"src/likee_scraper/cli/file_processor.cr","line_number":6,"url":null},"def":{"name":"call","args":[{"name":"file","doc":null,"default_value":"","external_name":"file","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Array(String) | ::Nil","visibility":"Public","body":"if File.exists?(file)\nelse\n  return\nend\nids = [] of String\nFile.each_line(file) do |line|\n  if line.empty?\n    next\n  end\n  if (line.starts_with?(/\\s/)) || (line.starts_with?(\"#\"))\n    next\n  end\n  ids << (line.gsub(INLINE_COMMENTS_REGEX, \"\")).strip\nend\nids\n"}}],"constructors":[],"instance_methods":[],"macros":[],"types":[]}]},{"html_id":"Likee Scraper/LikeeScraper/Connection","path":"LikeeScraper/Connection.html","kind":"module","full_name":"LikeeScraper::Connection","name":"Connection","abstract":false,"superclass":null,"ancestors":[],"locations":[],"repository_name":"Likee Scraper","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[{"id":"CONNECT_TIMEOUT","name":"CONNECT_TIMEOUT","value":"5.seconds","doc":null,"summary":null},{"id":"HTTPS","name":"HTTPS","value":"\"https\"","doc":null,"summary":null},{"id":"READ_TIMEOUT","name":"READ_TIMEOUT","value":"1.minute","doc":null,"summary":null}],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"Likee Scraper/LikeeScraper","kind":"module","full_name":"LikeeScraper","name":"LikeeScraper"},"doc":null,"summary":null,"class_methods":[{"id":"call(url:String,referer:String,&):Nil-class-method","html_id":"call(url:String,referer:String,&):Nil-class-method","name":"call","doc":"Executes a GET request and yields the response. If the response is not\nsuccessful, raises `LikeeScraper::HTTPError`.","summary":"<p>Executes a GET request and yields the response.</p>","abstract":false,"args":[{"name":"url","doc":null,"default_value":"","external_name":"url","restriction":"String"},{"name":"referer","doc":null,"default_value":"","external_name":"referer","restriction":"String"}],"args_string":"(url : String, referer : String, &) : Nil","args_html":"(url : String, referer : String, &) : Nil","location":{"filename":"src/likee_scraper/connection.cr","line_number":9,"url":null},"def":{"name":"call","args":[{"name":"url","doc":null,"default_value":"","external_name":"url","restriction":"String"},{"name":"referer","doc":null,"default_value":"","external_name":"referer","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":1,"block_arg":null,"return_type":"Nil","visibility":"Public","body":"uri = URI.parse(url)\nuri.scheme = HTTPS\nclient = HTTP::Client.new(uri, tls: true)\nclient.connect_timeout = CONNECT_TIMEOUT\nclient.read_timeout = READ_TIMEOUT\nheaders = HTTP::Headers {\"User-Agent\" => Likee::Utils.random_user_agent, \"Referer\" => referer}\nclient.get(uri.to_s, headers: headers) do |response|\n  if response.success?\n  else\n    raise(HTTPError.new(response))\n  end\n  yield response\nend\n"}}],"constructors":[],"instance_methods":[],"macros":[],"types":[]},{"html_id":"Likee Scraper/LikeeScraper/HTTPError","path":"LikeeScraper/HTTPError.html","kind":"class","full_name":"LikeeScraper::HTTPError","name":"HTTPError","abstract":false,"superclass":{"html_id":"Likee Scraper/Exception","kind":"class","full_name":"Exception","name":"Exception"},"ancestors":[{"html_id":"Likee Scraper/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"Likee Scraper/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"Likee Scraper/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[],"repository_name":"Likee Scraper","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"Likee Scraper/LikeeScraper","kind":"module","full_name":"LikeeScraper","name":"LikeeScraper"},"doc":"The `HTTPError` exception is raised when the HTTP status is not between\n200 and 299.","summary":"<p>The <code><a href=\"../LikeeScraper/HTTPError.html\">HTTPError</a></code> exception is raised when the HTTP status is not between 200 and 299.</p>","class_methods":[],"constructors":[{"id":"new(response)-class-method","html_id":"new(response)-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"response","doc":null,"default_value":"","external_name":"response","restriction":""}],"args_string":"(response)","args_html":"(response)","location":{"filename":"src/likee_scraper/exceptions/http_error.cr","line_number":9,"url":null},"def":{"name":"new","args":[{"name":"response","doc":null,"default_value":"","external_name":"response","restriction":""}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(response)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"id":"message:String-instance-method","html_id":"message:String-instance-method","name":"message","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : String","args_html":" : String","location":{"filename":"src/likee_scraper/exceptions/http_error.cr","line_number":12,"url":null},"def":{"name":"message","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"String","visibility":"Public","body":"\"HTTP status code #{status.code}: #{status.description}\""}},{"id":"response:HTTP::Client::Response-instance-method","html_id":"response:HTTP::Client::Response-instance-method","name":"response","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : HTTP::Client::Response","args_html":" : HTTP::Client::Response","location":{"filename":"src/likee_scraper/exceptions/http_error.cr","line_number":7,"url":null},"def":{"name":"response","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"HTTP::Client::Response","visibility":"Public","body":"@response"}},{"id":"status(*args,**options)-instance-method","html_id":"status(*args,**options)-instance-method","name":"status","doc":null,"summary":null,"abstract":false,"args":[{"name":"args","doc":null,"default_value":"","external_name":"args","restriction":""}],"args_string":"(*args, **options)","args_html":"(*args, **options)","location":{"filename":"src/likee_scraper/exceptions/http_error.cr","line_number":5,"url":null},"def":{"name":"status","args":[{"name":"args","doc":null,"default_value":"","external_name":"args","restriction":""}],"double_splat":{"name":"options","doc":null,"default_value":"","external_name":"options","restriction":""},"splat_index":0,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"response.status(*args, **options)"}},{"id":"status(*args,**options,&)-instance-method","html_id":"status(*args,**options,&)-instance-method","name":"status","doc":null,"summary":null,"abstract":false,"args":[{"name":"args","doc":null,"default_value":"","external_name":"args","restriction":""}],"args_string":"(*args, **options, &)","args_html":"(*args, **options, &)","location":{"filename":"src/likee_scraper/exceptions/http_error.cr","line_number":5,"url":null},"def":{"name":"status","args":[{"name":"args","doc":null,"default_value":"","external_name":"args","restriction":""}],"double_splat":{"name":"options","doc":null,"default_value":"","external_name":"options","restriction":""},"splat_index":0,"yields":1,"block_arg":null,"return_type":"","visibility":"Public","body":"response.status(*args, **options) do |*yield_args|\n  yield *yield_args\nend"}}],"macros":[],"types":[]},{"html_id":"Likee Scraper/LikeeScraper/UsernameNormalizer","path":"LikeeScraper/UsernameNormalizer.html","kind":"class","full_name":"LikeeScraper::UsernameNormalizer","name":"UsernameNormalizer","abstract":false,"superclass":{"html_id":"Likee Scraper/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"Likee Scraper/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"Likee Scraper/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[],"repository_name":"Likee Scraper","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[{"id":"BASE_URL","name":"BASE_URL","value":"URI.parse(\"https://likee.video\")","doc":null,"summary":null},{"id":"USER_AGENT","name":"USER_AGENT","value":"\"Mozilla/5.0 (compatible; Googlebot/2.1; +http://www.google.com/bot.html)\"","doc":null,"summary":null},{"id":"USER_ID_REGEX","name":"USER_ID_REGEX","value":"/\"uid\"\\:\"(?<user_id>\\d+)\",/","doc":null,"summary":null}],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"Likee Scraper/LikeeScraper","kind":"module","full_name":"LikeeScraper","name":"LikeeScraper"},"doc":null,"summary":null,"class_methods":[],"constructors":[{"id":"new(identifier:String)-class-method","html_id":"new(identifier:String)-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"identifier","doc":null,"default_value":"","external_name":"identifier","restriction":"String"}],"args_string":"(identifier : String)","args_html":"(identifier : String)","location":{"filename":"src/likee_scraper/user_profile/username_normalizer.cr","line_number":9,"url":null},"def":{"name":"new","args":[{"name":"identifier","doc":null,"default_value":"","external_name":"identifier","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(identifier)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"id":"call:String?-instance-method","html_id":"call:String?-instance-method","name":"call","doc":null,"summary":null,"abstract":false,"args":[],"args_string":" : String?","args_html":" : String?","location":{"filename":"src/likee_scraper/user_profile/username_normalizer.cr","line_number":13,"url":null},"def":{"name":"call","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"String | ::Nil","visibility":"Public","body":"if @identifier.starts_with?(\"@\")\nelse\n  return @identifier\nend\nresponse = @client.get(\"/#{@identifier}\")\nif response.success?\nelse\n  return\nend\nif match = response.body.match(USER_ID_REGEX)\n  match[\"user_id\"]\nend\n"}}],"macros":[],"types":[]},{"html_id":"Likee Scraper/LikeeScraper/UserNotFoundError","path":"LikeeScraper/UserNotFoundError.html","kind":"class","full_name":"LikeeScraper::UserNotFoundError","name":"UserNotFoundError","abstract":false,"superclass":{"html_id":"Likee Scraper/Exception","kind":"class","full_name":"Exception","name":"Exception"},"ancestors":[{"html_id":"Likee Scraper/Exception","kind":"class","full_name":"Exception","name":"Exception"},{"html_id":"Likee Scraper/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"Likee Scraper/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[],"repository_name":"Likee Scraper","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"Likee Scraper/LikeeScraper","kind":"module","full_name":"LikeeScraper","name":"LikeeScraper"},"doc":"The `UserNotFoundError` exception is raised if the given user could not\nbe found. It usually means that the target username or user_id is\ninvalid.","summary":"<p>The <code><a href=\"../LikeeScraper/UserNotFoundError.html\">UserNotFoundError</a></code> exception is raised if the given user could not be found.</p>","class_methods":[],"constructors":[],"instance_methods":[],"macros":[],"types":[]},{"html_id":"Likee Scraper/LikeeScraper/Utils","path":"LikeeScraper/Utils.html","kind":"module","full_name":"LikeeScraper::Utils","name":"Utils","abstract":false,"superclass":null,"ancestors":[],"locations":[],"repository_name":"Likee Scraper","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"Likee Scraper/LikeeScraper","kind":"module","full_name":"LikeeScraper","name":"LikeeScraper"},"doc":"The `Utils` module defines multiple helpers.","summary":"<p>The <code><a href=\"../LikeeScraper/Utils.html\">Utils</a></code> module defines multiple helpers.</p>","class_methods":[{"id":"retry_on_connection_error(&)-class-method","html_id":"retry_on_connection_error(&)-class-method","name":"retry_on_connection_error","doc":"Retries the *&block* when a connection error or a Likee API error occurs.","summary":"<p>Retries the <em>&block</em> when a connection error or a Likee API error occurs.</p>","abstract":false,"args":[],"args_string":"(&)","args_html":"(&)","location":{"filename":"src/likee_scraper/utils.cr","line_number":5,"url":null},"def":{"name":"retry_on_connection_error","args":[],"double_splat":null,"splat_index":null,"yields":0,"block_arg":null,"return_type":"","visibility":"Public","body":"on_retry_callback = ->(_ex : Exception, attempt : Int32, _elapsed_time : Time::Span, _next_interval : Time::Span) do\n  Log.error do\n    \"An error occoured while executing request; retring (#{attempt}/5)\"\n  end\nend\nRetriable.retry(on: {IO::TimeoutError, OpenSSL::SSL::Error, Likee::RequestFailedError, Likee::APIError, HTTPError}, on_retry: on_retry_callback, intervals: Array.new(5, 5.seconds)) do\n  yield\nend\n"}}],"constructors":[],"instance_methods":[],"macros":[],"types":[]},{"html_id":"Likee Scraper/LikeeScraper/VideoCollector","path":"LikeeScraper/VideoCollector.html","kind":"module","full_name":"LikeeScraper::VideoCollector","name":"VideoCollector","abstract":false,"superclass":null,"ancestors":[],"locations":[],"repository_name":"Likee Scraper","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[{"id":"MAX_VIDEOS_PER_PAGE","name":"MAX_VIDEOS_PER_PAGE","value":"100","doc":null,"summary":null}],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"Likee Scraper/LikeeScraper","kind":"module","full_name":"LikeeScraper","name":"LikeeScraper"},"doc":"The `VideoCollector` module defines the interaction with the Likee API\nto fetch videos from the user profile.","summary":"<p>The <code><a href=\"../LikeeScraper/VideoCollector.html\">VideoCollector</a></code> module defines the interaction with the Likee API to fetch videos from the user profile.</p>","class_methods":[{"id":"collect_each(user_id:String,last_post_id:String=&quot;&quot;,&)-class-method","html_id":"collect_each(user_id:String,last_post_id:String=&quot;&quot;,&)-class-method","name":"collect_each","doc":"Yields each video from the user profile. It iterates through all pages\nfrom the newest video to the oldest video.","summary":"<p>Yields each video from the user profile.</p>","abstract":false,"args":[{"name":"user_id","doc":null,"default_value":"","external_name":"user_id","restriction":"String"},{"name":"last_post_id","doc":null,"default_value":"\"\"","external_name":"last_post_id","restriction":"String"}],"args_string":"(user_id : String, last_post_id : String = <span class=\"s\">&quot;&quot;</span>, &)","args_html":"(user_id : String, last_post_id : String = <span class=\"s\">&quot;&quot;</span>, &)","location":{"filename":"src/likee_scraper/user_profile/video_collector.cr","line_number":9,"url":null},"def":{"name":"collect_each","args":[{"name":"user_id","doc":null,"default_value":"","external_name":"user_id","restriction":"String"},{"name":"last_post_id","doc":null,"default_value":"\"\"","external_name":"last_post_id","restriction":"String"}],"double_splat":null,"splat_index":null,"yields":1,"block_arg":null,"return_type":"","visibility":"Public","body":"loop do\n  collection = Utils.retry_on_connection_error do\n    Likee.user_videos(user_id: user_id, last_post_id: last_post_id, limit: MAX_VIDEOS_PER_PAGE)\n  end\n  if collection.empty?\n    break\n  end\n  last_post_id = collection.last.id\n  collection.each do |video|\n    yield video\n  end\nend"}}],"constructors":[],"instance_methods":[],"macros":[],"types":[]},{"html_id":"Likee Scraper/LikeeScraper/VideoDownloader","path":"LikeeScraper/VideoDownloader.html","kind":"class","full_name":"LikeeScraper::VideoDownloader","name":"VideoDownloader","abstract":false,"superclass":{"html_id":"Likee Scraper/Reference","kind":"class","full_name":"Reference","name":"Reference"},"ancestors":[{"html_id":"Likee Scraper/Reference","kind":"class","full_name":"Reference","name":"Reference"},{"html_id":"Likee Scraper/Object","kind":"class","full_name":"Object","name":"Object"}],"locations":[],"repository_name":"Likee Scraper","program":false,"enum":false,"alias":false,"aliased":null,"aliased_html":null,"const":false,"constants":[{"id":"Log","name":"Log","value":"::Log.for(\"Downloader\")","doc":null,"summary":null}],"included_modules":[],"extended_modules":[],"subclasses":[],"including_types":[],"namespace":{"html_id":"Likee Scraper/LikeeScraper","kind":"module","full_name":"LikeeScraper","name":"LikeeScraper"},"doc":null,"summary":null,"class_methods":[],"constructors":[{"id":"new(video:Likee::Video,directory:String?=nil)-class-method","html_id":"new(video:Likee::Video,directory:String?=nil)-class-method","name":"new","doc":null,"summary":null,"abstract":false,"args":[{"name":"video","doc":null,"default_value":"","external_name":"video","restriction":"Likee::Video"},{"name":"directory","doc":null,"default_value":"nil","external_name":"directory","restriction":"String | ::Nil"}],"args_string":"(video : Likee::Video, directory : String? = <span class=\"n\">nil</span>)","args_html":"(video : Likee::Video, directory : String? = <span class=\"n\">nil</span>)","location":{"filename":"src/likee_scraper/user_profile/video_downloader.cr","line_number":5,"url":null},"def":{"name":"new","args":[{"name":"video","doc":null,"default_value":"","external_name":"video","restriction":"Likee::Video"},{"name":"directory","doc":null,"default_value":"nil","external_name":"directory","restriction":"String | ::Nil"}],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"","visibility":"Public","body":"_ = allocate\n_.initialize(video, directory)\nif _.responds_to?(:finalize)\n  ::GC.add_finalizer(_)\nend\n_\n"}}],"instance_methods":[{"id":"call:Bool-instance-method","html_id":"call:Bool-instance-method","name":"call","doc":"Downloads a `Likee::Video`. The video is initially saved to a temporary\ndestination, then it's moved to its definitive destination.","summary":"<p>Downloads a <code>Likee::Video</code>.</p>","abstract":false,"args":[],"args_string":" : Bool","args_html":" : Bool","location":{"filename":"src/likee_scraper/user_profile/video_downloader.cr","line_number":10,"url":null},"def":{"name":"call","args":[],"double_splat":null,"splat_index":null,"yields":null,"block_arg":null,"return_type":"Bool","visibility":"Public","body":"begin\n  ensure_destination_directory_exists\n  File.write(metadata_destination, @video.to_pretty_json)\n  if File.exists?(destination)\n    Log.info do\n      \" + #{@video.creator_nickname} â€” #{@video.id}.mp4; exists\"\n    end\n    return false\n  end\n  Utils.retry_on_connection_error do\n    Connection.call(@video.download_url, referer: referer) do |response|\n      file_size = (response.headers.fetch(\"Content-Length\", \"1\")).to_u64\n      progress = build_progress_bar(file_size)\n      File.open(temp_destination, \"w\") do |file|\n        buffer = uninitialized ::StaticArray(UInt8, 4096)\n        while (len = (response.body_io.read(buffer.to_slice)).to_i32) > 0\n          file.write(buffer.to_slice[0, len])\n          progress.tick(len)\n        end\n      end\n    end\n  end\n  FileUtils.mv(temp_destination, destination)\n  true\nrescue IO::TimeoutError | HTTPError\n  Log.error do\n    \" ! Retries exausted: #{@video.download_url}; skipping\"\n  end\n  true\nend"}}],"macros":[],"types":[]}]}]}})